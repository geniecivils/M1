<!DOCTYPE html>
<html lang="fr" >
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>M1 GC</title>
<link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="icon" href="https://png.pngtree.com/png-vector/20241030/ourmid/pngtree-yellow-hard-hat-vector-png-image_14185637.png">
<style>
* {margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent;font-family:"Dela Gothic One",sans-serif;}
/* === Ø£Ù†Ù…Ø§Ø· Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ù† Ø§Ù„Ø¯ÙŠØ²Ø§ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù === */
::-webkit-scrollbar {
width: 10px;
}
::-webkit-scrollbar-track {
background-color: transparent;
border-radius: 10px;
}
::-webkit-scrollbar-thumb {
background-color: #2c2c2c;
border-radius: 10px;
}
::-webkit-scrollbar-thumb:hover {
background-color: #333;
cursor: pointer;
}

#fileInput{display: flex; width: 20%;}
h4{color: #333; font-size: 1.5em; text-align: center;}
h3{text-align: center;}

body{      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #121212;
      color: #f1f1f1;
      height: 100%;
      padding: 10px;
      margin-top: 10px;}
#loader{position:fixed;inset:0;background:#000d;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;}
.spinner{border:6px solid #333;border-top:6px solid #007acc;border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;}
@keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);} }
#loader p{margin-top:15px;font-size:1.1em;color:#007acc;}
#overlay{position:fixed;inset:0;background:#000d;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999;opacity:0;transition:opacity .5s ease;}
#overlay.show{opacity:1;}
video{width:300px;height:220px;border-radius:10px;border:2px solid #007acc;background:#000;object-fit:cover}
#message{margin-top:10px;font-size:1.1em;text-align:center;}
.container{      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      width: 100%;
      max-width: 600px;
      margin: auto;}
.selection-container,.content-container{background-color:#1e1e1e;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.5);width:100%;}
.selection-container h2,.content-container h2{text-align:center;padding-bottom:10px;}
.contents{display:flex;justify-content:center;flex-wrap:wrap;flex-direction: row-reverse;}
.btn{text-decoration:none;display:inline-block;margin:10px;padding:10px 15px;background-color:#1e90ff;color:white;border-radius:10px;text-decoration:none;text-align:center;font-size:1em;cursor:pointer; border: none;} /* ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© border:none */
.btn:hover{background-color:#007acc;}

/* === Ø³ØªØ§ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¶Ø§Ù === */
.button-row {
    display: flex;
    gap: 10px;
    justify-content: center; /* Ø³ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¨Ø³Ø¨Ø¨ dir="rtl" */
    width: 100%;
    /* margin-bottom: 10px;  Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© ØªØ­Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    /* flex-direction: row-reverse; */
}
.btn-refresh {
    background-color: #28a745; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± */
}
.btn-refresh:hover {
    background-color: #218838; /* Ø£Ø®Ø¶Ø± Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
}

/* === Ù†Ù…Ø· Ø§Ù„Ø¨Ø§Ù†Ø± Ù…Ù† Ø§Ù„Ø¯ÙŠØ²Ø§ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù === */
.myword1{
background:#79ff5f;
padding:10px 50px;
border:1px solid #333;
border-radius:10px;
font-weight:bold;
font-size:larger;
font-family:"IBM Plex Sans Arabic",sans-serif;
margin: 10px 0; /* ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù‡Ø§Ù…Ø´ */
width: 100%; /* Ù„ÙŠÙ…ØªØ¯ Ø¨Ø§Ù„Ø¹Ø±Ø¶ */
border-bottom: 1px solid #333;
}
.myword1:hover{background:#86fd6f;}

.stats {margin-top:12px;text-align:center;font-size:0.95em;color:#cbd5e1;}
#manualCodeContainer{margin-top:15px;display:flex;gap:10px;justify-content:center;align-items:center; width: 70%;}
#manualCodeInput{padding:8px 10px;border-radius:8px;border:none;font-size:1em; width:100%; }
#manualCodeBtn{padding:8px 15px;border:none;border-radius:8px;background:#1e90ff;color:#fff;cursor:pointer; width: 50%;}
#manualCodeBtn:hover{background:#007acc;}
#sessionPopup{
position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:2000;
}
#sessionPopupContent{
background:#1e1e1e;padding:25px 35px;border-radius:15px;box-shadow:0 0 20px rgba(0,0,0,0.6);
text-align:center;color:#fff;font-size:1.3em;font-family:'IBM Plex Sans Arabic',sans-serif;border:2px solid #e74c3c;
}
#sessionPopupContent button{
background:#e74c3c;color:white;border:none;padding:8px 20px;border-radius:10px;cursor:pointer;font-size:1em;margin-top:15px;
}
#sessionPopupContent button:hover{background:#c0392b;}

/* === CSS S2 (Ø§Ù„Ø£ØµÙ„ÙŠ) === */
.materials{display:flex;justify-content:center;flex-wrap:wrap;gap:15px;margin-top:15px;
/* === Ø¥Ø¶Ø§ÙØ© ØªØµÙ…ÙŠÙ… .model === */
margin: 10px 0;
border: 1px solid #333;
border-radius: 10px;
padding: 10px;
}
/* === ØªØ¹Ø¯ÙŠÙ„ .material-btn Ù„ÙŠØ¨Ø¯Ùˆ Ù…Ø«Ù„ .pdf-list a === */
.material-btn{
width: 100px; /* ØªØ¹Ø¯ÙŠÙ„ */
height: 100px; /* ØªØ¹Ø¯ÙŠÙ„ */
background: #2c2c2c; /* ØªØ¹Ø¯ÙŠÙ„ */
color: #fff;
font-weight: normal; /* ØªØ¹Ø¯ÙŠÙ„ */
border-radius: 10px;
display: flex;
justify-content: center;
align-items: center;
text-align: center;
cursor: pointer;
font-size: 1em; /* ØªØ¹Ø¯ÙŠÙ„ */
padding: 10px; /* Ø¥Ø¶Ø§ÙØ© */
border: 2px solid #2c2c2c; /* Ø¥Ø¶Ø§ÙØ© */
}
.material-btn:hover{
background:#1e1e1e; /* ØªØ¹Ø¯ÙŠÙ„ */
}

/* === CSS (Ø§Ù„Ø£ØµÙ„ÙŠ) === */
.pdf-container{position:fixed;inset:0;background:#000d;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:3000;padding:10px;}
.pdf-container iframe{width:100%;height:90%;border:none;border-radius:10px;}
.pdf-close-btn {
position: fixed;
top: 10px;
right: 10px;
background: rgba(0, 0, 0, 0.7);
color: #fff;
border: none;
padding: 40px 15px;
border-radius: 8px;
cursor: pointer;
z-index: 4000;
pointer-events: auto;
}
.pdf-close-btn:hover{background:rgba(0, 0, 0, 0.7);}

/* === CSS S1 (Ø§Ù„Ø£ØµÙ„ÙŠ) Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… === */

/* === ØªØ¹Ø¯ÙŠÙ„ .subject-section Ù„ÙŠØ¨Ø¯Ùˆ Ù…Ø«Ù„ .model === */
.subject-section {
margin: 10px 0;
border: 1px solid #333;
border-radius: 10px;
background-color: #1e1e1e;
width: 100%;
}
/* === ØªØ¹Ø¯ÙŠÙ„ h3 Ù„ÙŠØ¨Ø¯Ùˆ Ù…Ø«Ù„ .model-title === */
.subject-section h3 {
/* text-align: right;  ØªØ¹Ø¯ÙŠÙ„ Ù„Ù€ RTL */
color: #ffffff;
margin-bottom: 0;
/* font-family: "IBM Plex Sans Arabic", sans-serif; */
background-color: #2c2c2c;
padding: 10px;
border-bottom: 1px solid #333;
/* font-size: 1em; */
border-radius: 10px 10px 0 0;
/* flex-direction: row-reverse; */

/* === Ø¥Ø¶Ø§ÙØ§Øª Ù„Ø¬Ø¹Ù„Ù‡ Ù‚Ø§Ø¨Ù„Ø§Ù‹ Ù„Ù„Ù†Ù‚Ø± === */
cursor: pointer;
display: flex;
justify-content: space-between;
align-items: center;
font-size: 1em;
}
/* === Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© H:OVER === */
.subject-section h3:hover {
background-color: #333;
}

/* === ØªØ¹Ø¯ÙŠÙ„ .pdf-grid Ù„ÙŠØ¨Ø¯Ùˆ Ù…Ø«Ù„ .con === */
.pdf-grid {
display: grid;
grid-template-columns: repeat(3, 1fr); /* ØªØ¹Ø¯ÙŠÙ„ */
gap: 10px;
justify-content: center;
justify-items: center;
padding: 10px; /* Ø¥Ø¶Ø§ÙØ© */
direction: ltr; /* === Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ === */
}
/* === ØªØ¹Ø¯ÙŠÙ„ .pdf-box Ù„ÙŠØ¨Ø¯Ùˆ Ù…Ø«Ù„ .pdf-list a === */
.pdf-box {
width: 90px;  /* ØªØ¹Ø¯ÙŠÙ„ */
/* height: 100px;  ØªØ¹Ø¯ÙŠÙ„ */
background: #2c2c2c; /* ØªØ¹Ø¯ÙŠÙ„ */
color: #f1f1f1;
border: 2px solid #2c2c2c; /* ØªØ¹Ø¯ÙŠÙ„ */
border-radius: 10px; /* ØªØ¹Ø¯ÙŠÙ„ */
display: flex;
justify-content: center;
align-items: center;
text-align: center;
cursor: pointer;
font-size: 1em; /* ØªØ¹Ø¯ÙŠÙ„ */
font-weight: normal; /* ØªØ¹Ø¯ÙŠÙ„ */
transition: background-color 0.3s;
padding: 10px 5px; /* Ø¥Ø¶Ø§ÙØ© */
}
.pdf-box:hover {
background-color: #1e1e1e; /* ØªØ¹Ø¯ÙŠÙ„ */
color: #f1f1f1; /* ØªØ¹Ø¯ÙŠÙ„ */
}
/* === Ù†Ù‡Ø§ÙŠØ© CSS S1 === */

</style>
</head>
<body>
<div id="loader">
  <div class="spinner"></div>
  <p>VÃ©rification de la connexion...</p>
</div>
<div id="overlay">
  <video id="video" autoplay></video>
  <div id="message">Veuillez scanner le code QR ou saisir le code pour entrer...</div>
  <input type="file" id="fileInput" accept="image/*" style="margin-top:10px;">
  <div id="manualCodeContainer">
    <input type="text" id="manualCodeInput" placeholder="Entrez le code ici" />
    <button id="manualCodeBtn">vÃ©rification</button>
  </div>
</div>
<div id="sessionPopup">
  <div id="sessionPopupContent">
    SESSION TERMINEE ğŸ”’
    <br>
    <button id="popupBtn">OK</button>
  </div>
</div>
<div class="container" id="content">
  <div class="selection-container" id="selectionContainer">
    <h2>ğŸ‡µğŸ‡¸</h2>
        <h3> ğŸ‘·ğŸ»â€â™€ï¸ M1 STRUCTURE ğŸ‘·ğŸ»â€â™‚ï¸ </h3>
            <h2></h2>
    <h2>Choisissez le semestre</h2>
    
    <div class="contents">
      <a href="#" class="btn" onclick="goToPage('contentS2')">S2</a>
      <a href="#" class="btn" onclick="goToPage('contentS1')">S1</a>
      </div>

                    <h4>X</h4>

  </div>
  <div class="content-container" id="contentS1" style="display:none;">
    <h2>ğŸ‡µğŸ‡¸</h2>
    <h2>Semestre 1</h2>
    <div class="button-row">
        <button class="btn" onclick="returnToSelection()">RETOUR</button>
        <button class="btn btn-refresh" onclick="location.reload()">REFRESH</button>
    </div>
        
    <button class="myword1">
      Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ùˆ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ùˆ Ù„Ø§ Ø§Ù„Ù‡ Ø§Ù„Ø§ Ø§Ù„Ù„Ù‡ Ùˆ Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±
    </button> 
    
    <div class="subject-section">
      <h3 onclick="togglePdfList('mds-grid')">MDS<span>â–¼</span></h3>
      <div class="pdf-grid" id="mds-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         

      </div>
    </div>
    <div class="subject-section">
      <h3 onclick="togglePdfList('dds-grid')">DDS<span>â–¼</span></h3>
      <div class="pdf-grid" id="dds-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         


      </div>
    </div>


    <div class="subject-section">
      <h3 onclick="togglePdfList('beton-grid')">BETON<span>â–¼</span></h3>
      <div class="pdf-grid" id="beton-grid" style="display: none;">

        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         

      </div>
    </div>

        <div class="subject-section">
      <h3 onclick="togglePdfList('charpente-grid')">CHARPANTE<span>â–¼</span></h3>
      <div class="pdf-grid" id="charpente-grid" style="display: none;">

        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         

      </div>
    </div>



                <div class="subject-section">
      <h3 onclick="togglePdfList('thermique-grid')">THERMIQUE<span>â–¼</span></h3>
      <div class="pdf-grid" id="thermique-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         


      </div>
    </div>


                    <div class="subject-section">
      <h3 onclick="togglePdfList('python-grid')">PYTHON<span>â–¼</span></h3>
      <div class="pdf-grid" id="python-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         


      </div>
    </div>
    

                    <div class="subject-section">
      <h3 onclick="togglePdfList('innovants-grid')">METHODE INNOV<span>â–¼</span></h3>
      <div class="pdf-grid" id="innovants-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         


      </div>
    </div>


                        <div class="subject-section">
      <h3 onclick="togglePdfList('exprimentale-grid')">METHODE EXPRI<span>â–¼</span></h3>
      <div class="pdf-grid" id="exprimentale-grid" style="display: none;">
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         


      </div>
    </div>

                    <div class="subject-section">
      <h3 onclick="togglePdfList('batiment-grid')">BATIMENT<span>â–¼</span></h3>
      <div class="pdf-grid" id="batiment-grid" style="display: none;">

        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 1</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 2</div>         
        <div class="pdf-box" onclick="openPDF('https://drive.google.com/file/d/1SOvG9-Tzdl7LF-Z0rxYJ0KRw5w3Rxt3j/preview?embedded=true')">PDF 3</div>         

      </div>
    </div>


              <h4>X</h4>
  </div>
  <div class="content-container" id="contentS2" style="display:none;">
    <h2>ğŸ‡µğŸ‡¸</h2>
    <h2>Semestre 2</h2>
    <div class="button-row">
        <button class="btn" onclick="returnToSelection()">RETOUR</button>
        <button class="btn btn-refresh" onclick="location.reload()">REFRESH</button>
    </div>
        
    <button class="myword1">
      Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ùˆ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ùˆ Ù„Ø§ Ø§Ù„Ù‡ Ø§Ù„Ø§ Ø§Ù„Ù„Ù‡ Ùˆ Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±
    </button> 

    <div class="materials">

    </div>
  </div>
</div>
<div class="pdf-container" id="pdfContainer">
  <button class="pdf-close-btn" onclick="closePDF()">RETOUR</button>
  <iframe id="pdfFrame" src=""></iframe>
</div>
<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, get, set, onValue, onDisconnect, update, runTransaction } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyC4ffOpGSHS3fdRV1X0aztZU7D1hzttYq0",
authDomain: "my-id-19724.firebaseapp.com",
databaseURL: "https://my-id-19724-default-rtdb.firebaseio.com",
projectId: "my-id-19724",
storageBucket: "my-id-19724.appspot.com",
messagingSenderId: "788057820357",
appId: "1:788057820357:web:b37f49ddb60ec489bd34ac",
measurementId: "G-5QX27XCFK6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const loader = document.getElementById('loader');
const message = document.getElementById('message');
const content = document.getElementById('content');
const manualCodeInput = document.getElementById('manualCodeInput');
const manualCodeBtn = document.getElementById('manualCodeBtn');
const fileInput = document.getElementById('fileInput');
const sessionPopup = document.getElementById("sessionPopup");
const popupBtn = document.getElementById("popupBtn");
const pdfContainer = document.getElementById('pdfContainer');
const pdfFrame = document.getElementById('pdfFrame');

let scanning = false;
let streamRef = null;
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");
let deviceIdGlobal = null;
let heartbeatIntervalId = null;
let allowedCodesSet = new Set();

/* Fingerprint */
async function getDeviceFingerprint() {
if (localStorage.getItem("deviceId")) return localStorage.getItem("deviceId");
const fp = await FingerprintJS.load();
const result = await fp.get();
const deviceId = result.visitorId;
localStorage.setItem("deviceId", deviceId);
return deviceId;
}

function getDeviceName() {
try { return `${navigator.platform || "unknown"} â€” ${navigator.userAgent || "unknown"}`; } 
catch { return "Unknown Device"; }
}

function getLocation() {
return new Promise((resolve) => {
if (!("geolocation" in navigator)) return resolve(null);
navigator.geolocation.getCurrentPosition(
(pos) => resolve({lat: pos.coords.latitude,lng: pos.coords.longitude,accuracy: pos.coords.accuracy}),
() => resolve(null),
{ enableHighAccuracy: true, timeout: 8000 }
);
});
}

/* ÙƒØ§Ù…ÙŠØ±Ø§ */
async function startCamera() {
try {
const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
video.srcObject = stream;
streamRef = stream;
scanning = true;
scanLoop();
} catch (err) {
message.textContent = "L'appareil photo n'a pas pu dÃ©marrer !";
console.error(err);
}
}
function stopCamera() { scanning=false; if(streamRef) streamRef.getTracks().forEach(t=>t.stop()); video.srcObject=null; streamRef=null; }

/* Ù…Ø³Ø­ QR */
async function scanLoop() {
if (!scanning) return;
if (video.readyState === video.HAVE_ENOUGH_DATA) {
canvas.width = video.videoWidth;
canvas.height = video.videoHeight;
ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
const code = jsQR(imageData.data, canvas.width, canvas.height);
if (code) await handleScannedCode(code.data.trim());
}
requestAnimationFrame(scanLoop);
}

/* ØªØ­Ù„ÙŠÙ„ QR Ù…Ù† ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© */
fileInput.addEventListener("change", async (e)=>{
const file = e.target.files[0];
if(!file) return;
const img = new Image();
img.onload = async ()=>{
canvas.width=img.width; canvas.height=img.height;
ctx.drawImage(img,0,0);
const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
const code = jsQR(imageData.data, canvas.width, canvas.height);
if(code) await handleScannedCode(code.data.trim());
else message.textContent="Aucun code QR trouvÃ©!";
};
img.src = URL.createObjectURL(file);
});

/* load allowed codes */
function startAllowedCodesWatcher() {
onValue(ref(db,'allowedCodes'), snap => {
const val = snap.val()||{};
allowedCodesSet = new Set(Object.keys(val));
});
}

/* handle code (QR Ø£Ùˆ password) */
async function handleScannedCode(scanned) {
if (!allowedCodesSet.has(scanned)) { message.textContent = "Code invalide âŒ"; return; }
const codeRef = ref(db, "codes/" + scanned);
const snapshot = await get(codeRef);
const deviceId = await getDeviceFingerprint();
deviceIdGlobal = deviceId;

if (!snapshot.exists() || snapshot.val().usedBy === deviceId) {
if(!snapshot.exists()) await set(codeRef,{used:true,usedBy:deviceId,lastUsedAt:Date.now()});
await grantAccess(scanned);
} else {
message.textContent = "âŒ Ce code est utilisÃ© depuis un autre appareil";
}
}

/* grant access */
async function grantAccess(scanned) {
message.textContent="VÃ©rifiÃ© avec succÃ¨s âœ…";
stopCamera();
const deviceId = await getDeviceFingerprint();
deviceIdGlobal=deviceId;
const deviceName=getDeviceName();
const location=await getLocation();
const now=Date.now();
const sessionRef=ref(db,`sessions/${deviceId}`);
const sessionData={code:scanned,deviceName,location:location||null,enteredAt:now,online:true,lastSeen:null,lastHeartbeat:now,exitAt:null};

try {
const visitorRef=ref(db,`visitors/${deviceId}`);
const visitorSnap=await get(visitorRef);
await set(sessionRef,sessionData);
await onDisconnect(sessionRef).update({online:false,lastSeen:Date.now(),exitAt:Date.now()});
await update(ref(db,`codes/${scanned}`),{used:true,usedBy:deviceId,lastUsedAt:Date.now()});
if(!visitorSnap.exists()){
await set(visitorRef,{firstSeen:Date.now(),deviceName});
const totalRef=ref(db,`counters/totalVisitors`);
await runTransaction(totalRef,current=>(current||0)+1);
} else { await update(visitorRef,{lastSeen:Date.now(),deviceName}); }

localStorage.setItem("qr_access_granted","true");
localStorage.setItem("qr_code_value",scanned);
    
    // *** Ø¥Ø¶Ø§ÙØ©: ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø© ***
sessionStorage.setItem('currentPageId', 'selectionContainer');
    
setTimeout(()=>{
overlay.style.display="none"; content.style.display="flex";
// Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù† Ù†Ø­ØªØ§Ø¬ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ù‡Ù†Ø§ØŒ Ø¯Ø§Ù„Ø© init Ø³ØªÙ‡ØªÙ… Ø¨Ø°Ù„Ùƒ
startRealtimeSessionWatcher(); startHeartbeat(deviceId);
},800);
} catch(err){ console.error("grantAccess error:",err); message.textContent="Ø®Ø·Ø£ ÙÙŠ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";}
}

/* heartbeat ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© */
function startHeartbeat(deviceId){
if(heartbeatIntervalId) clearInterval(heartbeatIntervalId);
heartbeatIntervalId=setInterval(async()=>{
try{
// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ù„Ø§ ØªØ²Ø§Ù„ Ù…Ø±Ø¦ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø¨Ø¶
if (document.hidden) {
stopHeartbeat();
updateSessionOffline();
return;
}
await update(ref(db,`sessions/${deviceId}`),{lastHeartbeat:Date.now(),online:true});
}catch(e){console.warn("Heartbeat failed:",e);}
},1000); // ØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø© Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯Ù‚Ø©
}
function stopHeartbeat(){ if(heartbeatIntervalId) clearInterval(heartbeatIntervalId); heartbeatIntervalId=null; }

/* Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø¬Ù„Ø³Ø© */
async function startRealtimeSessionWatcher(){
const savedCode=localStorage.getItem("qr_code_value");
if(!savedCode) return;
const deviceId = await getDeviceFingerprint();
const codeRef=ref(db,"codes/"+savedCode);
onValue(codeRef, snap=>{
if(!snap.exists() || snap.val().usedBy!==deviceId){
stopCamera(); overlay.style.display="flex"; content.style.display="none";
sessionPopup.style.display="flex";
localStorage.removeItem("qr_access_granted");
localStorage.removeItem("qr_code_value");
      
      // *** Ø¥Ø¶Ø§ÙØ©: Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ ***
sessionStorage.removeItem('currentPageId');
      
stopHeartbeat();
updateSessionOffline();
}
});
}

/* popup */
popupBtn.onclick=()=> location.reload();

/* === (init) Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¹Ø¯Ù„Ø© === */
(async()=>{
// 1. Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
loader.style.display = "flex"; 

// 2. Ø¬Ù„Ø¨ Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
const deviceId = await getDeviceFingerprint(); 
deviceIdGlobal = deviceId;
startAllowedCodesWatcher(); 

// 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø© ØµØ§Ù„Ø­Ø©
const savedCode = localStorage.getItem("qr_code_value");
let sessionIsValid = false;

if (savedCode) {
try {
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const snap = await get(ref(db, "codes/" + savedCode));
if (snap.exists() && snap.val().usedBy === deviceId) {
sessionIsValid = true;
}
} catch (e) {
console.error("Error checking saved session:", e);
sessionIsValid = false; // Ø£ÙŠ Ø®Ø·Ø£ ÙŠØ¹Ù†ÙŠ Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©
}
}

// 4. Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±
loader.style.display = "none"; 

if (sessionIsValid) {
// 5. Ø§Ù„Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø©: Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
overlay.style.display = "none";
content.style.display = "flex";

    // *** Ø¥Ø¶Ø§ÙØ©: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« ***
const savedPageId = sessionStorage.getItem('currentPageId');
if (savedPageId && savedPageId !== 'selectionContainer') {
goToPage(savedPageId); // Ø§Ù„Ø¯Ø§Ù„Ø© goToPage Ø³ØªÙ‡ØªÙ… Ø¨Ø§Ù„Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ù„Ø¥Ø¸Ù‡Ø§Ø±
} else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª 'selectionContainer' Ø£Ùˆ nullØŒ Ø£Ø¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        returnToSelection(); 
    }
// *** Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© ***
    
startRealtimeSessionWatcher(); // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ù„Ø®Ø±ÙˆØ¬)
// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù†Ø§ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ù…Ø±Ø¦ÙŠØ©
if (!document.hidden) {
startHeartbeat(deviceId); 
updateSessionOnline(); // ØªØ³Ø¬ÙŠÙ„ Ø£Ù†Ù†Ø§ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
} else {
updateSessionOffline(); // ØªØ³Ø¬ÙŠÙ„ Ø£Ù†Ù†Ø§ Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø¥Ø°Ø§ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
}
} else {
// 6. Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©: Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¹Ø±Ø¶ Ø´Ø§Ø´Ø© QR
localStorage.removeItem("qr_access_granted");
localStorage.removeItem("qr_code_value");
    
    // *** Ø¥Ø¶Ø§ÙØ©: Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ§Ø´Ù„ ***
sessionStorage.removeItem('currentPageId');

overlay.classList.add("show");
startCamera();
}
})();
/* === Ù†Ù‡Ø§ÙŠØ© Ø¯Ø§Ù„Ø© init Ø§Ù„Ù…ÙØ¹Ø¯Ù„Ø© === */

/* navigation */
window.goToPage=function(pageId){
document.querySelectorAll('.content-container').forEach(c=>c.style.display='none');
document.getElementById('selectionContainer').style.display='none';
document.getElementById(pageId).style.display='block';
  
  // *** Ø¥Ø¶Ø§ÙØ©: Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ***
sessionStorage.setItem('currentPageId', pageId);
};
window.returnToSelection=function(){
document.querySelectorAll('.content-container').forEach(c=>c.style.display='none');
document.getElementById('selectionContainer').style.display='block';
  
  // *** Ø¥Ø¶Ø§ÙØ©: Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ***
sessionStorage.setItem('currentPageId', 'selectionContainer');
};

/* === Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø¶Ø§ÙØ© === */
window.togglePdfList = function(id) {
// Ø¬Ù„Ø¨ ÙƒÙ„ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…ÙˆØ§Ø¯ ÙÙŠ S1
const allPdfLists = document.querySelectorAll('#contentS1 .pdf-grid');
// Ø¬Ù„Ø¨ ÙƒÙ„ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¯ ÙÙŠ S1
const allTitles = document.querySelectorAll('#contentS1 .subject-section h3');

const pdfList = document.getElementById(id);
if (!pdfList) return;

// Ø¬Ù„Ø¨ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¶ØºÙˆØ·
const titleIcon = document.querySelector(`[onclick="togglePdfList('${id}')"] span`);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ÙØªØ­ (Ù„Ø£Ù†Ù‡ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§)
const isOpening = (pdfList.style.display === "none" || pdfList.style.display === "");

// 1. Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
allPdfLists.forEach(list => {
list.style.display = "none";
});

// 2. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ù„Ù‰ "â–¼"
allTitles.forEach(title => {
const span = title.querySelector('span');
if (span) span.textContent = "â–¼";
});

// 3. ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØºÙ„Ù‚Ø©
if (isOpening) {
pdfList.style.display = "grid";
if (titleIcon) titleIcon.textContent = "â–²";
}
// (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙØ¥Ù† Ø§Ù„Ø®Ø·ÙˆØ© 1 Ùˆ 2 ØªÙƒÙˆÙ† Ù‚Ø¯ Ø£ØºÙ„Ù‚ØªÙ‡Ø§ Ø¨Ø§Ù„ÙØ¹Ù„)
}
/* === Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© === */


/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ */
async function updateSessionOffline(){
try{
const deviceId=deviceIdGlobal||localStorage.getItem("deviceId");
if(deviceId) {
const sessionRef = ref(db, `sessions/${deviceId}`);
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
const snap = await get(sessionRef);
if (snap.exists()) {
Â await update(sessionRef, {online:false, lastSeen:Date.now(), exitAt:Date.now()});
}
}
} catch(err){ console.warn(err);}
}
window.addEventListener("beforeunload", updateSessionOffline);
window.addEventListener("unload", updateSessionOffline);


// ==========================================================
// === Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§Ù Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© (Online/Offline) ===
// ==========================================================

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© (Ø¬Ø¯ÙŠØ¯) */
async function updateSessionOnline(){
try{
const deviceId = deviceIdGlobal || await getDeviceFingerprint();
if(!deviceId) return;

// Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¬Ù„Ø³Ø© Ù‚Ø¨Ù„ Ø¥Ø¹Ù„Ø§Ù† "online"
const savedCode = localStorage.getItem("qr_code_value");
if (!savedCode) return; 

const codeSnap = await get(ref(db, "codes/" + savedCode));

// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙƒÙˆØ¯ Ù„Ø§ ÙŠØ²Ø§Ù„ ØµØ§Ù„Ø­Ù‹Ø§ ÙˆÙ„Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
if (codeSnap.exists() && codeSnap.val().usedBy === deviceId) {
// Ø§Ù„Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø©ØŒ Ù‚Ù… Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«
const sessionRef = ref(db, `sessions/${deviceId}`);
await update(sessionRef, {online:true, lastHeartbeat:Date.now(), exitAt:null});
// Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¨Ø¶Ø§Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙ‚ÙØ©
if(!heartbeatIntervalId) startHeartbeat(deviceId);
} else {
// Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù… ØªØ¹Ø¯ ØµØ§Ù„Ø­Ø© (Ø±Ø¨Ù…Ø§ ØªÙ… Ø·Ø±Ø¯Ù‡ Ø£Ø«Ù†Ø§Ø¡ ØºÙŠØ§Ø¨Ù‡)
// Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ØŒ startRealtimeSessionWatcher Ø³ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‡Ø°Ø§
// ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
stopHeartbeat();
}
} catch(err){ console.warn("updateSessionOnline failed:", err); }
}

/* Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØºÙŠÙŠØ± Ø¸Ù‡ÙˆØ± Ø§Ù„ØµÙØ­Ø© (Ø¬Ø¯ÙŠØ¯) */
function handleVisibilityChange() {
 Â // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ Ø£ØµÙ„Ø§Ù‹
if (!localStorage.getItem("qr_code_value")) return; 

if (document.hidden) {
// Ø§Ù„ØµÙØ­Ø© Ù…Ø®ÙÙŠØ© - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙÙ„Ø§ÙŠÙ†
stopHeartbeat();
updateSessionOffline();
} else {
// Ø§Ù„ØµÙØ­Ø© Ø¸Ø§Ù‡Ø±Ø© - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
updateSessionOnline();
}
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„ØµÙØ­Ø© (Ø¬Ø¯ÙŠØ¯)
// Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
document.addEventListener("visibilitychange", handleVisibilityChange, false);

// ==========================================================
// === Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§Ù Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© (Online/Offline) ===
// ==========================================================


/* ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙŠØ¯ÙˆÙŠØ© */
manualCodeBtn.onclick = async ()=>{ const code = manualCodeInput.value.trim(); if(code) await handleScannedCode(code); };

/* PDF */
// --- ÙŠØ¬Ø¨ ØªØ¹Ø±ÙŠÙ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… (window) ---
window.openPDF=function(url){
pdfFrame.src=url;
pdfContainer.style.display='flex';
}
window.closePDF=function(){
pdfContainer.style.display='none';
pdfFrame.src='';
}


/* no touch 
document.addEventListener('contextmenu', function(event) {
event.preventDefault();
});

document.addEventListener('keydown', function(event) {
if (event.key === 'F12' || 
(event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'J')) ||
(event.ctrlKey && event.key === 'U')) {
event.preventDefault();
}
});


*/

</script>
</body>
</html>
